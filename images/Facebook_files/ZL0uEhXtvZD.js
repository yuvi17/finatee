if (self.CavalryLogger) { CavalryLogger.start_js(["LwGj7"]); }

__d('LegacyMentionsInput.react',['cx','FocusListener','Bootloader','TypeaheadMetricsConfig','Event','Keys','React','ReactDOM'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();c('FocusListener');var i=c('React').PropTypes,j=c('React').createClass({displayName:'ReactLegacyMentionsInput',propTypes:{initialData:i.object,placeholder:i.string,datasource:i.object,ref:i.string,viewOptionsTypeObjects:i.object,viewOptionsTypeObjectsOrder:i.array,hashtags:i.bool,autoflip:i.bool,onEnterSubmit:i.func,onFocus:i.func,onBlur:i.func,onContentChange:i.func,onTypingStateChange:i.func,onPaste:i.func},componentDidMount:function(){this.props.initialData&&this._initializeTextarea(c('ReactDOM').findDOMNode(this));},hasEnteredText:function(){return !!(this._mentionsInput&&this._mentionsInput.getValue().trim());},submitComment:function(event){var k;if(event){k=event.target.value&&event.target.value.trim();}else{var l=c('ReactDOM').findDOMNode(this.refs.textarea);if(l.value&&l.value!==l.placeholder)k=l.value;}k=k||'';var m={visibleValue:k,encodedValue:k};if(this._mentionsInput)m.encodedValue=this._mentionsInput.getRawValue().trim();var n=this.props.onEnterSubmit(m,event);if(n&&this._mentionsInput){this._mentionsInput.reset();event&&event.preventDefault();}},_handleKeydown:function(event){var k=event.nativeEvent,l=c('Event').getKeyCode(k)==c('Keys').RETURN&&!c('Event').$E(k).getModifiers().any,m=this._mentionsInput&&this._mentionsInput.getTypeahead().getView().getSelection();if(this.props.onEnterSubmit&&l&&!m)this.submitComment(event);},_handleFocus:function(){this.props.onFocus&&this.props.onFocus();this._initializeTextarea(c('ReactDOM').findDOMNode(this.refs.root));},_handleBlur:function(){this.props.onBlur&&this.props.onBlur();},_initializeTextarea:function(k){if(this._mentionsInput||this._bootloadingMentions)return;this._bootloadingMentions=true;c('Bootloader').loadModules(["CompactTypeaheadRenderer","ContextualTypeaheadView","InputSelection","MentionsInput","TextAreaControl","Typeahead","TypeaheadAreaCore","TypeaheadBestName","TypeaheadHoistFriends","TypeaheadMetrics","TypeaheadMetricsX","TypingDetector","UFIComments"],function(l,m,n,o,p,q,r,s,t,u,v,w,x){var y=c('ReactDOM').findDOMNode(this.refs.textarea);new p(y);if(this.props.onTypingStateChange){var z=new w(y);z.init();z.subscribe('change',this.props.onTypingStateChange);}var aa={autoSelect:true,renderer:l,causalElement:y,autoflip:this.props.autoflip};if(this.props.viewOptionsTypeObjects)aa.typeObjects=this.props.viewOptionsTypeObjects;if(this.props.viewOptionsTypeObjectsOrder)aa.typeObjectsOrder=this.props.viewOptionsTypeObjectsOrder;var ba=new q(this.props.datasource,{ctor:m,options:aa},{ctor:r},c('ReactDOM').findDOMNode(this.refs.typeahead)),ca=[s,t];if(c('TypeaheadMetricsConfig').gkResults){var da=new v({extraData:{event_name:'mention_metric_x'}});da.init(ba);}var ea=new u({extraData:{event_name:'mentions',from_location:'comments'}});q.initNow(ba,ca,ea);this._mentionsInput=new o(k,ba,y,{hashtags:this.props.hashtags});this._mentionsInput.init({},this.props.initialData);if(this.props.initialData)n.set(y,y.value.length);if(this.props.onPaste)c('Event').listen(y,'paste',this.props.onPaste);if(this.props.onContentChange)this._inputOnChangeSubscriber=this._mentionsInput.subscribe('valueUpdate',function(fa,ga){var ha=ga.value;this.props.onContentChange(ha);}.bind(this));this._bootloadingMentions=false;}.bind(this),'LegacyMentionsInput.react');},focus:function(){try{c('ReactDOM').findDOMNode(this.refs.textarea).focus();}catch(k){}},componentWillUnmount:function(){if(this._mentionsInput&&this._inputOnChangeSubscriber)this._mentionsInput.unsubscribe(this._inputOnChangeSubscriber);},render:function(){var k="textInput"+(' '+"mentionsTextarea")+(' '+"uiTextareaAutogrow")+(' '+"uiTextareaNoResize")+(' '+"UFIAddCommentInput");return (c('React').createElement('div',{ref:'root',className:'uiMentionsInput textBoxContainer ReactLegacyMentionsInput'},c('React').createElement('div',{className:'highlighter'},c('React').createElement('div',null,c('React').createElement('span',{className:'highlighterContent hidden_elem'}))),c('React').createElement('div',{ref:'typeahead',className:'uiTypeahead mentionsTypeahead'},c('React').createElement('div',{className:'wrap'},c('React').createElement('input',{type:'hidden',autoComplete:'off',className:'hiddenInput'}),c('React').createElement('div',{className:'innerWrap'},c('React').createElement('textarea',{ref:'textarea',name:'add_comment_text',className:k,title:this.props.placeholder,placeholder:this.props.placeholder,onFocus:this._handleFocus,onBlur:this._handleBlur,onKeyDown:this._handleKeydown})))),c('React').createElement('input',{type:'hidden',autoComplete:'off',className:'mentionsHidden',defaultValue:''})));}});f.exports=j;},null);
__d('legacy:dom-html',['HTML'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();b.HTML=c('HTML');},3);